package co.rsk.peg.bitcoin;

import co.rsk.bitcoinj.core.Address;
import co.rsk.bitcoinj.core.BtcECKey;
import co.rsk.bitcoinj.core.BtcTransaction;
import co.rsk.bitcoinj.core.Coin;
import co.rsk.bitcoinj.core.NetworkParameters;
import co.rsk.bitcoinj.core.Sha256Hash;
import co.rsk.bitcoinj.core.TransactionInput;
import co.rsk.bitcoinj.script.RedeemScriptParser;
import co.rsk.bitcoinj.script.RedeemScriptParserFactory;
import co.rsk.bitcoinj.script.Script;
import co.rsk.config.BridgeConstants;
import co.rsk.config.BridgeMainNetConstants;
import co.rsk.peg.BridgeUtils;
import org.bouncycastle.util.encoders.Hex;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.MethodSource;

import java.util.LinkedList;
import java.util.List;
import java.util.Optional;
import java.util.stream.Stream;

class BitcoinUtilsTest {
    private static final BridgeConstants bridgeMainnetConstants = BridgeMainNetConstants.getInstance();
    private static final NetworkParameters btcMainnetParams = bridgeMainnetConstants.getBtcParams();
    private static final int FIRST_INPUT_INDEX = 0;

    private Address destinationAddress;

    @BeforeEach
    void init() {
        destinationAddress = BitcoinTestUtils.createP2PKHAddress(btcMainnetParams, "destinationAddress");
    }

    private boolean isSigHashValid(Sha256Hash sigHash, List<BtcECKey> pubKeys, List<BtcECKey.ECDSASignature> signatures) {
        LinkedList<BtcECKey> keys = new LinkedList<>(pubKeys);
        LinkedList<BtcECKey.ECDSASignature> sigs = new LinkedList<>(signatures);

        while (sigs.size() > 0){
            BtcECKey pubKey = keys.pollFirst();
            BtcECKey.ECDSASignature signature = sigs.getFirst();
            if(pubKey.verify(sigHash, signature)){
                sigs.pollFirst();
            }
            if (sigs.size() > keys.size()) {
                return false;
            }
        }
        return sigs.isEmpty();
    }

    private static Stream<Arguments> pegoutOrMigrationArgProvider() {
        return Stream.of(
            // PEGOUT - https://www.blockchain.com/explorer/transactions/btc/99ff14d8d0b339f6144291940c5f99e8fd4002fb300cebde963555fd395ee943
            Arguments.of("0200000001188d5f9de5b8db6f4be05da4ae4a2d150112c333cee829b7f096feb1ebcb473401000000fd3703004730440220630a0c2fbe56cc78ff6506c64a8013b4fb703ade2c1c23c3a9973d6bf1d59ac802200aa28a08deb20ead5bd84ee003f5f17dfbf643f2e96079b878eba798f155191d01473044022043e2e3c82a74a817425de96e8e317e3f96e462b0e96441f4e301b1e6d2df4d7602206ee7d453f61cc55d0ad6530438876a21ed2e3b240cd487cf9ddf2ad17a40047d01483045022100c312a5c6f87d1903f89f158bdb3e8f3385a049ebedb7bb1d4753176881e2981502201eb50518f76f47587c6781c1b39f7ede1349df01b65036e7d80a09252149662d0147304402203370ab37f6b24d723ccc7a6b9cd4dfe9f30449a64effb47d1f5e1727a93afa5f022004733ecc46c19c762f0a4372b882fcec1209990f7bf1426f94f79b29534816700147304402203af20ed490bf6b140e2df8770025e333869fa6f54a6cf152e6666c1054eb3424022023f255af0855464f26165a026ede6d6db7475c7442353a3dcd17dc4bc61fb14201004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492102a95f095d0ce8cb3b9bf70cc837e3ebe1d107959b1fa3f9b2d8f33446f9c8cbdb2103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf9321034851379ec6b8a701bd3eef8a0e2b119abb4bdde7532a3d6bcbff291b0daf3f252103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff0281c00e00000000001976a9140ab5592fc4c28f2301014da9981a3f1d7ad3d4af88ac597ebc2d4900000017a914056d0d9c5b14dd720d9f61fdb3f557c074f95cef8700000000"),
            // PEGOUT 3 inps 3 out - https://www.blockchain.com/explorer/transactions/btc/7b7bc2cca070deb1b3e202e2f8d9be7348f69bda0a701ef499c1f0406b33d0f0
            Arguments.of("02000000035d4a4d9fa1e8d3a810fb79ab6af65e875e2da48ceacf883ee3eb1350f78f481401000000fd390300483045022100b915a8d23e56c4ca3ae8ce694b45f6446e1f272dfb2b8c37541e04626736f160022078f6c86fa292cfd877cb91f648972cf28262ca65bfc3297bfa88e278393656e701483045022100bce9e38bef3c79b98c63d1c5604ce6e631bfb0ab51462de66ab2310c9577f9f702200b1a98d6aeebe4859415d6ab51958d7a4102e52f3f9cbb5a5d04c4564ba8acfa01483045022100ed20bc010cd5467b8f976e85ae1a626d0d72a82e074b3f5cd115553c5015e2af0220285443e3db6d5862ebaef64ef850fc36efc33ed16d59df29f979f25dc782786401473044022079e19ba94faa0fd37a554868e63829fb8c85f42d4301e5f9212d789cfd096eba022037f50dedfb515da45d656c605535af53a8e67e5526387ae11968c37b526ffc3d0147304402202e316f978c48d88a2d50cecb7ea7b9fa920a8205fc4c2c856bd72f30514f69f802201e22a376b27a05327e1c124649f420ff18920987bb988fab067da20f61bc7dc901004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff368c3c6a740e215bfbd60faacc5885ede43de7a87426957c4d76b7b5a07bf11a01000000fd3703004730440220096807ec5f91a30ed3c49945db5820f530a6b10d653f27be787aeb9d1243c1d402205f1863aeedef1910894cfa43fb64197f8cb08998f660bc1a2af6596b2c7e7e8c01483045022100a4d8dcd392ef62e3e78d217c5f1309d6e36499bad95b9304f0924ca33fe521870220106e810b87d31f1142948dab10b64dde8c4c4aeecfcfd9d4e3b04af09a67a37f01473044022054aa34d30322652774b728e16aab33d7265884df1de3da64f9e778b1bc8e2b4902203f2b41b0e58afda47dab72ed1e70ffb1f0f318f5bfa93ad47457a706d2f86cdf01473044022002bd4600f97b5749f09dfd72a59bc6ea20fbf8f8912e469693a49f87d2ad5b6b0220793494917fcae899ba68aa5517f4cb9bf79d9557cc3a875b8698eeb50118df74014730440220193683a85f4f55252ae03a425bd467f99afa4b90623df37148dba35edb141fe502203453bd283cb9ff80f455c5242ad5119c4f0e7bb6d07d4d318874393a7fdbe0e201004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68fffffffff54165dedd85e84c81d2c871691d340c09e517fe1682d88182fe6590f083b13201000000fd390300473044022072f4c7f3e46434ef430afdd04ed18cf1ee81c4eb1918ea11161f680b05760c4a02201a26ab2140e5b56d2fe5d9a7d13f1314d068d8474ecc9cbb645f954bebab408a0147304402205a5140e6cd439cb635a39ad2726be7c3b6efc7cf0df34448a13c121b4ff88e2f022028575ee392fd7794aadc109e6d7f77693cd051a1edaf441537a25d090adf285101483045022100d3169a848fad8dc9c656dbacc49ea467b2882f0c1818e70f6d3f17643a998617022037332b2b5b91a85459dc813b38c9b071ef0603de7562c8a2d0eefc4b8ff231b20148304502210087747097228747e619c95401cb67dfc452d136df0971813aa7b0033e5b4bd3e70220408e0452570a6c4b1c342937908c0e3529499f8e96411ea4d13927604893005b01483045022100d9d745fe94c8c36912bfbb9d216dcdafbbd7280c3d4327d8bc38998156bdf4680220082e9a9af7fa3eaedde5f8ef2398deb478569235c1ff7b4810225bc154b208a301004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff0343fe4306000000001976a91418fb0cfdf2d17cdd9900353f78fde52526690fd988ac63f83200000000001976a914c7a0c95ffda01c74e9eb62d7202d458cd98a715288ac97e76d6b0000000017a9142c1bab6ea51fdaf85c8366bd2b1502eaa69b6ae68700000000"),
            // MIGRATION with a single input - https://www.blockchain.com/explorer/transactions/btc/13716a5cc50cfb4e19f813813920cdd3e558f98ca977b64f36679fe86700cec8
            Arguments.of("01000000016540ddb6bcbd84288846800e28098a664ea6b76b97fe1162d99f8c9fe669a90201000000fd38030047304402207b5a099c4d5c4408654fa6408938951fad885345b94e01b85bb51292e176c01002203ac70093682a303ca1d53067f9750eac2dad9129ad2984a01d1d6af10db255b90147304402206064d6767a21903d5db5355d24d89ff23a3754c2897da0fda9bff991a9464f60022037a639400d98bf1fcaeb5d7153464b36043e6fd98a68cbfba7678b87dc14fdbd01483045022100e1bf08138dc20a2fe6f6b29a5910d484528f2a5cff11990902412d07fd2f950f0220144854fe4b39ecc5d179e16f6f7e8d5fc7f10d78ca29d3fc577454abeb446e1e01483045022100df6507ce4d7b39f2683206ebd7d0d1aba04ad57dead04caf4f5a1245ffbe4a190220016e04b9dad5de6b5d91050a166e1c763ed6f691f67f8df120d89fefe3474f270147304402206d78d7197155c6320a8acc08277050bf386baac268bad1c4aae45f2518941a18022072a29afbb55eae4fc934930d8ebb1734f54aa3adc874f3df3729e57285cc6cbf01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff01924fa4210000000017a914056d0d9c5b14dd720d9f61fdb3f557c074f95cef8700000000"),
            // MIGRATION with 18 inputs - https://www.blockchain.com/explorer/transactions/btc/40923d0ed2ae305820d5fe5e5abbd806e13211cfa16c8de91eeaaa7b59d3ccac
            Arguments.of("0100000012c4979ec09728c25d695025ee347da738d6f9265ed8e74fd286e5739af9f7dc4300000000fd3a0300483045022100925ed17cc5b16243a8c87bec14763048ba26598cfd77c320302f58751efe068a022052e9b38b47782ee36f3c381e1c0d8e7198057011a5bd6b0d4eef9e1d8902f22101473044022049b304c76df557fc367d9a7a93c64f1889cd258e66ac4beabca9e466f1f19a6c02202b396258cd43f0bfb41d48027640f620aa516d576679bbfb00d7544872816da501483045022100c38fc11cfae8c56875748bee0640c0bf093f02cdfbc14a6ed3e298dc99ef8595022057b1f9d81b0dfbcc8eecbc7ff55d312f0b108b6c1c3cbdc8a74a8a67591cb90a01483045022100bbd3917823c53a2001f620e02a09fc4445572fcaa6684c10d05d663e58c912c50220440c7920a60506c75a525d0d02c14aa86afe759a94fdb49b54c78f21331d0cc501483045022100bf74758d9cb60ae1a4b0fad1d7e2c62d2d063dfd92090d87c626f7fdf173598b022045d0f30bef23603e9a1b422ea38cea442bff20f2cf53239edbafd7e6c53dfe2e01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffd46b4b043feb265ea7ce387d12f60ce8f460c2f11ddfd033a1db220687456da301000000fd380300483045022100cb5a18f739837d05e47eb3029a2a9bcc267061b1ba83e2bdc2147e2f25d1a12c022079b5c8291102cd2e0a4691d2e9caca021e0d825880068a123b03011562160fff014830450221009046177548619c235330d6dfee70d85e5f708f617a21078db3957f5cb1d73d3602206e6cadf3da672c6a5df857a691f5ab823af45b1fce7d906e1616284cd178b14601473044022015cadedeb72cdb626a0b7216bb5e426e0cc102b3ade11a10837a486f85026a0302203fdc3f9ac11c3c51a945e53c2af625de8d7319179c0a8d7f0d4191af299c5d660147304402203e444af2289da004f0a2976216a7af53b210252b84422c45ac6680c1693820b202204920b5ef1774272b88ed18926681fdc038bed8c6e9db3b50a6b6d984497a2e4d01473044022011fdbde49fd5be20fbd8ac6127a487b55854db2de993993a4f25a8f49d6ab1dd02201a5d40182fd405b41d5aec7f1d83e4e0866b58857f2bda9f794439d512e575a501004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffa4b9884f6d828af81eb1dfa8ccd2ec4738c5dfd9bf67539a9383e21846865bf701000000fd390300483045022100982c12d0d2465efc92a36a6b3f0e59fa72d03dddfefa63b95aa0b0b4cedeabb702203739a11caf3c88948f5dfb67c4ed2e1f9226ca33fe906d53930e175835efb5eb0147304402205702c6c6f832a6425b129c3a45495c2f1a3be9f88c9b609924820cf60ac2e1ae022071f88dcdfde5431c0b20d2111736c7b91f6d9bbb31cd365c2e8dd6aa7830b70901473044022019df45babe0d4798624bc5195a83d96945ed537b004697b2d79d8572e658f048022036c4b5a3b048415b2c789fbc2c1e92c85a4ee214d8bbe5325f3a2fbd2eb6cc7901483045022100802f47b80d407fab077a675de8e4fb3c039476fe5fc265bd48151bf82559e658022021b2fd7a7c9cca8bb6496fbd7721fe74d028598d5231d92ddd17592751b2e09f01483045022100840ab971fc394f99d7db049e43ad055816b8e7ef02ba28a6773243d3cbfcab49022015af7434b6c229b561c7c6f9f61ed9889150e15466eb0baf77caa506066e621101004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffa37bea90e51addabadade0d01446509fa0f28af8163a5ef5af159d1f55f283f701000000fd38030047304402202a56f1425284e97cb12386755927ad4089b4835256506a83046b4fdcf241e9e502204e9c6698ff206dc79d3b40d02795b0c78c5604a246e44696b3fba1f7d49c474c0147304402205e4c37dcbc86ba6c7fd0763309bcebe4d62d1563a10e447e9c2e7b96803e3abd02203590910f8d64dcb857783f1702c35b99b868836145b74debc570cf3aed399e7301473044022079f8a12d4eb46ff596c9f0a8ed51c535005c8fb525bbc65e2a26efc8795f789a02201b15ef5fa6a82668fc2ad09573e43ec0f9c70a7fe88ff492e13efa00bf439d8c01483045022100e5f2ffd03206a22c2095bc62650cbcd83087fdf0d851c6ffc6ce34d661345c84022007e63fee3fb4e7785b20bf3876ba4f98c132524d7da38b714dde6faa8d08df9a01483045022100965c3f18d956ba176a4125281abf7f3cbe5ec1c7867e6bdd9fd58267da77682402203caf7e0ee47301253265eb94f38290f388cfe0ae35804d6c0a732d7f5bd583d801004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff7d1aecb1316a584c9889fed6de3160f72c5c73dbc072d22479beef95cb60d0f700000000fd38030047304402201207ca185803e6609911b4c7739006f267790e53b524a7cc14d83b1a12dcc6f102203cca28be2e51faf9a4e39d69fb24501874693c864877a27ed74079a1a86f14b701473044022008ca77b0cba65facff8c55a4c4128e79240101ce650f00d18880b3b2e6accf3302207017844271adc2d78936b2970f97e3beacd6bcea8657fca74db562d296602ca801483045022100de15aa8e61142be2c07a6fec913ff031b7c56a74f5c146c0369d289bbded040902202178bcdc29ba8b518cd45b113a1b46dbb7fac0b83b741b5c86216a44a364f94f0147304402204f52876ec8412e3b44e2ecb10b7cab726ab1aa50ede76373654fa847a37e208c02200080dd83b98d41ff2c400722d6efaadb1263765b839aae50aeda6ee33cb617d8014830450221009ada39b2694ff3ac5c934114101c04ca9155a0d75becfba9c62e65c384009eed022038e7e27cde29ef3204e334299ae29e65a1a52ace3d7b15d7e07d25184667774b01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff231f05c4640a10d81aa91819af887797410dd27f51bc13b318f3c6c80e5fd2f700000000fd3a0300483045022100f9978d9b1c0c6316d95f01e3845baadd755424a5f8a384b95f24dcbd6792cc9d02205b86a710a38ae49c043c3a67f0139fddef583e48456733c2e748ee7b05a574fe01483045022100bfb08e8b32d2755638f6f69e5c721aff618e8df82e856791a05e51d4c01d3c5c02206543522b2d74db284ee0bb3675115ea1e8e9a0f7ecbb09d3fa9c95afdf78841a01483045022100f1b2d72724d52092c8416e580cc3b9b9faae6bbe4926506a2ed55b89cfde43bd0220678b4832542452ce0c823de2fbef9b037e373e67ac33c864d660ebb5ea41685d01483045022100dbf66e54d9a85c5f294aa15b10899600c904f99822177b516d25ee9428a60a4302207aa0d0d61f55d0b1ac415d7884084522649d1b63a4d46325e6ea5965523a2a70014730440220178bca237897a84d7752985379693ffc430a9b8b383de9679b952f2570b57c7f02201594603952ada1dece14dd268a5912a447ad970b00e89c80b094eaffc2a37d3601004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff9ffda00aaa6f378ad1e77f9225993c5bcfd2896527f36c58fb63aae3dfdafff701000000fd390300483045022100e9ec2c21575dd678a5dec15d3955a2237152db92adbf3f47a296f6717358db8602204ad0d200d2bce179b610b6dd1669d399e98580bc3f7886c1e32691353b709c7101473044022014bf48f5a4c692028fe0f35c65b866ad0836f94a27251b187b2192774963643f02203ad4a33bacf395185878955f3ea87abc94d6602daaac8203b95beba519b4cbb001483045022100c5732676aa55cb7145bdc6502503703be3a9475e43435735f4a162d8e58b771a0220471f604b56331feab82b39bed0d82854eaca20d5e4fc048b63c3384db29650980148304502210085fd0b98bc341077a718daee5981fb990c5458b824b8bddaabb5f4072af25112022000b59f5438229fde6e2a38c24e30f7eca611db499c331ad061677003057d149d014730440220065dc81de81a32f1dbcb88d0613251aad53dae90e60330ac786560fb215282aa02205865919bb49d5e5b92a7ba587a5de1cc021bd66673754ae1baff412051897b6a01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff227733746aae98e34036a709b51e71be3c27299f12f3bf88fd038efd12534bf801000000fd38030047304402201e14f370d374037e7c174a2efd07eb711fddaa70ac55b575b2e23c64f00d3d09022062d5be2eec28e122e0d15a71b4d33a6e9f45e20095357158189cb6546205263b01483045022100a9cb45ff8c215f049c697ffa9001f2d7d761f8dbd33aa2cca611630a8c0bd5c202204ce280f072aa6967389c52d1ff3c3862d43ab47480456ccc4b43ca87a4d7a4a401473044022015045a62ce419c2193e15ddd3952498cb6560010e16c8c72bb58cda9e13accc3022062d334a53b127ce3d280345eb56c094d942259074d6a4e4baf72a89de5aab26e0147304402207d52c21406a4f1e45ba9cec912f0f538eb9431109c006dbb6a7a823a0ca6f75302204c69fa37215f1283378c41454c56bce4e14edc701dfb97fdded8293be24c0fa901483045022100e48613c471ae9e5b4aba89a9d060d631cdf94503bd74b3961fdb3ed64c21475802207a80d7a8be29111bc844ac7f067090061b80b3c7616bd58a759c1cf633b7e50c01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff92b589af6f9198cabeb352cc0e1fc227aab6fef9c49a2dbbe6076edcb1356ff800000000fd38030047304402204379c3de717a222edabf74c30c82ace05bab8ad83301c4f23aacbae86259a90602205cbb7db66ca32ee25ec02d3b7a6942f158f56f87e3abeedc831db2dcb773572c01483045022100d688cf75d46b3fda5f9beb871c51098013c52e132648301e2329468c063db34c022004fc72ed672cd955eff5b2aa952422ab3d474dc7b8e4dcd4710911a05907a4330147304402205460d92af24bbd704bc4679d7b6e2acde5b01773c687c0a5b492e2f14aebd8df02201f8964120a3fe21fc258a14ce7c3de0468b704f91a9b8d9507686fe070f4f3cf01483045022100a34eff2df1fb6f1dd3de3980669e964540b373f263dabd05d6398d4d6fb27535022019b95cb80f51e003a8f37a86d3f3410d2d02848af4f54aaccac51c84854c80810147304402205825b75c869b5a3fc4087180a87e4e230fe7e6c2d00c8bb36aa7d7c1a900e2ca022074fe9f8a0fb2718d6cacddc704fb99485c19e15e242c6a0dce5d8db001581e1e01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff2fe1483046972456cf52bc197e256526e9d086973a7da5944a406c671954abf800000000fd390300473044022077c65b5fab584069e0a20bafe0e4f826b367b31e44b0932bd91618e4d6bcd71e02200e7b2032f8d35f373fa7fdb52d26ad90ba9d3794a1a6d5264830d59487c7eff201483045022100af9edb4fc458d07c670cd06c8b0aeaec449d90f5e1dfae06eed14da7acdd48e0022069358a2c75dd2c77234e0aba0ee53276f9a983db288a3aee56745d2af378830801473044022033a3a6b9af39dce64d0cf03bedc77903e0d6b1f5d0e3a350f24de52feb81147a02200cf5371169cdf7b608bf9a4017609ee9dcf6592348fb0f780c444dec606a79dc01483045022100ec39ed60c600c85900f6db0919a9791b8cfbbe5b7b8f9ece93616649b3a9fd63022023a5eaf915ecef56cbe0db0b853a1ab4f1022a26ef820092fe29bc953892000401483045022100ecdaa3601573d305f2f01b7be1342b0af77b4a4318fc3d0fda1548d6aeee12e50220654a8937975af56a087ad39dfa86b1cba49ad0ca73c47545cc2f2e04b68f0c5d01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffb202eaab8bb3db99e15fa5721faa49f4af67014a1c118b0f6d7e806a68fcccf801000000fd39030047304402206a87ddd444f65019dd7efdca636f9e8906ab6e9e8f37da80f65f0544ab99469702203b1216bfb137e32ed70098157d7434b73eda60c806d14591d81aba0fda8b1de201483045022100853d980d87a26c8f21f863aceb71586b4d9857838171c6aedc81d9697028dd2d022044e31d63f059becd68d54a681133636180c5542b7a2f1585531fdee50de87e2001483045022100d4dda467b3559463a9dc4933ff30f20012c21b4c8f35a62a0f0f09171babd2e802206727c3329a8eefe48f5eec910294e441dae80b160e708d53474f54384cdbbdb301483045022100ba8e45729164c21ef143b072f8109be94d91ae2524275a1306a4e362f0a79b860220684bbda1cc3c6226ba51c123ba15136956643dad699ff7d824a86915059415360147304402207de05a7d66218948df59682f58d347e03eb516d62c14625f42f875ad546640c402205886cd70fe1dcb7dfca3044953b7bc7b39cdb36d4ec8ecf2b61c744bd83355b001004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff7229027c56b89f0cbaab63b4cc990d55c0fc01a1409f524039bf2705206beff801000000fd38030048304502210092d67528895292150943d5e98148a41fcb4ff684f1946d7c18e9d917e4092fa8022062cc154f66fb5e689818ebd8c98a9e35cb25cea14272e2387b20df34999498e601483045022100fab31a4654208a9998704c79ca2cbb5238f6ce04e11717ec724962d7a8e015dd022028cec6033b840e39a57776bd0dc96e2d12d7118cbe1079826bca3e4bb8e93a4601473044022010f6e26d0968dd69830bd23143ca30aa0fdbe7448fb47cab3ffb9a9668ce22f502205e74e55ebc041736852e37b1b76ae39d81f88f7c95b8cd1c2ac147b5a9bf47380147304402200c6e36c79c89d1ef0b4c860810a709ffe515e2aa68dea51f13b21730f5320bda02205997b9e19a0e1fbeb656898d41b729ebb6a5354ef950bb2770b6a1d01ec0d8ba0147304402202e75359d2ec4df222de724ef8591dd7d834b22d8350be709d9de3e3aec974548022054e12a356ff731d0e47a958b16126311b2c83fa10b52bfefca3ab6501c03045301004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff639d2d330209f8c866e8b3460cda2996b0c8f6406eec915ed3811fcbf26a08f901000000fd3903004730440220220ccdaddf9296aa1a654d4332b150de9d7459b52a4e425df24e3e8245351b9f02200dcc81df3a175b46e08b2d0bac3de3aa19e52932a10ada295e198dab5237ddb3014730440220573a18f45aab4081c219fce41617bc11414f33efdc8ea1bdac35273710686afd022056b0cd6439987f8bf389ccfbc049756056224ee28ffd05e0b1ac3018ce08f88e01483045022100bdafe3d9b3b440d44d8a42eaf9bdd5046b0c817688c994287b464bf71551db9d0220718fcef9cf360ca20da32a138de2fdf7afbecc606e3240bc61ee6172ca99c5ba01483045022100e65a4d5a4c9d85a9c03a1e31cc04d69c112e4a4e92577b3b0776ead8b230f4aa02204ebb8d2ba7d5ed65e4857df92d9e2bf6112e194b813949dfedc2eca4ac05e72001483045022100bce85705306ca9e726ff44e0d9a0ae61a17552e924a78ce76aaec33598c597a302204257fbf941b161f2c16373366b58452bf9d0a47e3fb1b9ab5901bb04bc0ab6a501004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff0a7068a6e9f40feb3192442bd262443964defa4b57c067da3c0016c0dd6c5bfb00000000fd3a03004730440220561abbe1ee16f9c12fea2568d53cbb3f60e026e73412564eaded052392e19a380220723babccecd2eb269173b892d72ee68620a54a1e08cfc4c5abced4d53559ce8b01483045022100b4942b4f3e3b06cc1112b8539dc3d4647b728b0941cf22fa7ca086a93739ce3b02200999ff250eb7bb761c668d5ea6a6aa02452f455b025bfe8cc16cfe827d9dd91c01483045022100e6ed96aaf288b8c1deb093a6c23e59c773b91acedd46ed1a08fb01f77c84cd7b02200ef3aebfd3fe4410fcf495dfa00dc10c54024a7b025ccf988790b73f68b77aed01483045022100b39121102fa726a0ab8a23cb209979f85279802cd6b1a9402368149ec84e4743022057cf4a30cc91b966d0079df256ca56cb711d9e05eb63a7e1915f43219e0bca4f01483045022100d0850dcb6342039b34815f96b9fa8a91ebd6a04ddea577b64eb0ab06f0b79fca022040d86228fe806f402e0f76677394ee14dfe627e15f3e009f2ce019d13c64ef4c01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffc2d4923d2845731c1dff9825a756063f71129f90df89a8ab06760d231af857fd01000000fd390300483045022100d1a8191fc08721257c86d356a135e1acaaecca9584ecae09f6b9f85bdea0348e0220705010b9884a3539fb2879573a615d267b11e90c360ab4ca16471598a419fb1601483045022100c5b5fee14442804097c23f260491f530a3893d92bd719d3941a44fc6b499c14b022041251320d7c700161a212bf0795908f4dda9acdb23a79a0e3a332d96a55a3c9301483045022100edd9900b16578e3df296a900e247f5c0b5afb72db3d730f1fd6ca66fcfd3595b02202e5e3f86708422d71fab38aafe43412d6f88b92278f02e4604579b82204ea5040147304402200f565400277bc3e8de45d6ef431627d6a1430e3835cd167f98f6ce0240e56a7602206712d41d58fbffcbb3592ace02d8057c4acbc0791fc44ecb1f94e86714764148014730440220692d549c545cc491d64eb50d695e635041559bd9a78251d35ee5258cc1447422022011fd917331e2faeb885f57ff26c62a92c6640ad238436ef9b878609431285c6e01004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffa94af0b5a7fe0da24bd661ed9fa595681a4ac8a342b90ed71dd2bf2c5c3981fd01000000fd380300473044022005dd59c449a35914abe0717ffe6ca33637d04c3b99698e2e5f873ab788843685022019907b83ff43fcec6faf3121b256cd681bfade3ccf9e3ae2ccab1c7c01f5cc3c014830450221008e915c384b6a09fd53c7522fc1625555740bbb49eec9dc72c4dd86793947515b02203d0df1b1a9b22acaabc5b7db98a86f54a0be54b67457eb55cdac53b2aff7a1d301483045022100960966abaecba7f2668b090c9c42d597aaa0f68c5aa03ae2c056e4956cc45cf702202767a925990dacb686021756c941053e0e6a27697e9bb77e1a26be346ab7b9690147304402207885c059b61ae7bf9ec65f550af3c6fd2ab2ded4af643b7a51670528af3de8c9022030de4e6bf2f2eb1e9c74d5a3263f2373bb5f2bde7c588566853a27ae971cae5a0147304402203a0c6f6d6967a9f38833b186767350c82f1ee4d2ff5a7733d7822f00c57d0e230220105d67fabc82b92c7ce78f6d9b59d0429110e4ee5512544a05d7f5f5a73bb06401004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff2fd8c2007abae71ed861b5c049a1874c36f54035bcad5fcb92e9c1a416ebc3fe00000000fd380300483045022100b81b393b5ff5bef5c5ee152f2758c7bfe3e38b97c4fecca7d9c1ffcdad318ccb022069e659f93b5c91d39232f014bca01f598bec9a11b14606dd29a02d26df356ea40147304402201d3c148a04ca37f6fa4f01fe2c7347ac4b234c8dd9020b3dc26e4a4be2fd908c022041913c22bfed6eb90e016cdb11eea0117d78f57af701ac9953014f9bc7a9e41e0147304402203450a8c4721b533193e3559ad6f79951886bd91be59337c984431346fa101ce2022020912f980ceabba89a4bcf80f8cfd1056bbb6a2b88d459aafb33ff495ebcdae201483045022100a194f0c5ee15f4c27ec298ed3f64a15192b52b763c7aff1f65530a567de565ea02200352ff0d910f5bc3ea57d1dce846aad7e4f231c8a154158b2affe2604614943b014730440220447ad4f66f3dbf729db9139073e6b0dd020248b6fc7cf1ffb9691e6ea7bb0bd8022008862a308db4905c9122e84a266c7c07aa0e17ace6c77335a2df4d2ec5f4e17701004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffffa2766c1e534e000cc84fe9c916c2f3c8fec173ea9f763ac2e3e414789470dbff01000000fd3703004730440220717a877c788f91e9cab64cfe04731781f0fce2ee4c17c1857887528e4c1da626022003cef77a5480a52ad13871f88b12057a5818e5a20a9484263f74f7508b7f5840014830450221009fe14bd7bd6a814f0a972f481c15c69a57ce1c0508d4cee3306a2772dc931535022055a69c7698e6898c3b827b125f1054bccf70c588ffce8966e7cb190c05e599c90147304402205bdf738e4c97e8a673a984c0e20d91c4d2c3c5251527f77f55fa3e95b89f5dce0220744e3e8ceb317dc64bb8d4c0589a47030cb474fb68b56e78cb9963d6ab62ffad0147304402204b0fb630dd5bba12c86e7d4c77914b93f511b00e274b774377a2065ada744c9902200b7eeab1b2f8bf14dd9fa5d16fc350cc7ff7f72880d02c6867bfacb0dc0b5c090147304402202e2d15a7ad0fda0d6182bfb5c0dffc1734539d48db23825dd0e63f091e0bee8802206abd87aa613ed017e5cda42cdfd8241d633ad896ab29dcc988bb424c87376f4801004dc901645521020ace50bab1230f8002a0bfe619482af74b338cc9e4c956add228df47e6adae1c21025093f439fb8006fd29ab56605ffec9cdc840d16d2361004e1337a2f86d8bd2db21026b472f7d59d201ff1f540f111b6eb329e071c30a9d23e3d2bcd128fe73dc254c210275d473555de2733c47125f9702b0f870df1d817379f5587f09b6c40ed2c6c9492103250c11be0561b1d7ae168b1f59e39cbc1fd1ba3cf4d2140c1a365b2723a2bf93210357f7ed4c118e581f49cd3b4d9dd1edb4295f4def49d6dcf2faaaaac87a1a0a422103ae72827d25030818c4947a800187b1fbcc33ae751e248ae60094cc989fb880f62103b58a5da144f5abab2e03e414ad044b732300de52fa25c672a7f7b358887719062103e05bf6002b62651378b1954820539c36ca405cbb778c225395dd9ebff678029959ae670350cd00b275532102370a9838e4d15708ad14a104ee5606b36caaaaf739d833e67770ce9fd9b3ec80210257c293086c4d4fe8943deda5f890a37d11bebd140e220faa76258a41d077b4d42103c2660a46aa73078ee6016dee953488566426cf55fc8011edd0085634d75395f92103cd3e383ec6e12719a6c69515e5559bcbe037d0aa24c187e1e26ce932e22ad7b354ae68ffffffff0184faec2d4900000017a914056d0d9c5b14dd720d9f61fdb3f557c074f95cef8700000000"),
            // MIGRATION including flyover utxos - https://live.blockcypher.com/btc-testnet/tx/da818033d9c73628dcd69149e0d4b219f265fe7eec34bbf8bfe60a2a5f97e15d/
            Arguments.of("010000000528db684e7db1a99b8b2e993d8287b4a8fa2b3d389b68c325fb7652efa034997a01000000fdda0100483045022100dfe75719007a65bd3bcb0b72523640fa22f4ad5f67732f04a413b9242e4f70d802203778bc407e0226190382b29308b764c2217f16f658df732f176e04f498a8a8c4014730440220130142ee038c35dfbd3e6f56254ffb66b7fe9498d6aa9406e3f481b9a49af2a70220192b4cb7969fa87e474229d77b6242075e9762541773385bc3c784cf010c3f2e01483045022100be6c644745cca8056d33f63880a9f547ca60ca0e2cf16230b3baf007ad9cf0ff02204e73f48484a77f19140e956110a62ecba4317e709482dda8cf9d55f9e95d138b01004cfc64532102fd9b5a58d8e1ac73afee2828b3b2b20338436622971862f2a284c62ad754b8642103462ab7041341dadd996dc12ef0c118ca8ccb546498cbf304f7ffe0f1b12f9a9e210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db54ae6702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b2453ae68ffffffffc032507cfb1f07b51506cd9aadf68a49e1545b4ea1ed052533c15ed94d63948d00000000fddb010048304502210093b6b913d11eecf160667235d54aed14879be74533353fab8ce708d07a79caee0220290d633fd4fa15621bd5c73915605442a435f8c250ffb793da48f8b8be73f95b01483045022100856acb1f62cd208321237c64e3ce4a297454fe089063fb4917697601104fece3022073efdf1dc2bf2ce05a33b3506f4a243aee6dc225fe26b5cd1eaf5e7cf7c1b8d501483045022100af556c58509a31c957c84d7f7518a99f3d8fde1cfe5a734a019b5e27fa3961860220776dd43e1cb5489d064a98468c8d0057b840f20a04e0cc529406de341935397801004cfc64532102fd9b5a58d8e1ac73afee2828b3b2b20338436622971862f2a284c62ad754b8642103462ab7041341dadd996dc12ef0c118ca8ccb546498cbf304f7ffe0f1b12f9a9e210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db54ae6702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b2453ae68ffffffff1d2e963299915d00b0ceb3ef9f8074011a9b16cc88dbd66b0d93cb08c5fa36b300000000fdda010048304502210083b057b6c529b11a955acdb5779e5b967b0e9e2991af78821f2862331df4b38202206179e6957e129a4d51b312d0225a7ad58dbce8e43d2a19e1c77ef7bdf4c4c6510147304402207f80597b8453f510110e77cff6f97fd5b56736b89e68e677c4ec4569b83c997a022057635545848611a40143411051bba08afe140c0732366dde3ae8de68258147ba01483045022100b520ceeea54b71746ba44f45c7dc2f620b0cc58a47f34414714d0e9de05c494902202c79116bf04ca7db6f59f4cf7eb7fafd80b0e37a5fe4c5d333d7fe4a6c165dfd01004cfc64532102fd9b5a58d8e1ac73afee2828b3b2b20338436622971862f2a284c62ad754b8642103462ab7041341dadd996dc12ef0c118ca8ccb546498cbf304f7ffe0f1b12f9a9e210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db54ae6702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b2453ae68ffffffffe9c4f0d704dc9e491165cd5ffd3517e8f4bf788dff7e577c88cc6cd4876535d300000000fdfd01004830450221009fb23875b5137ca94dace40e316bd84cd66d1dad96cbdad54c5271b6e77100e002202177d10d70d4d900d9cff8f156f2d3bf7fd714a26c9ac0535640dc6c465d649801483045022100e1b5083bdd05183ce1838716e941f55307c9b185529d215eee8a797bafd3b1af02203173386f49afbdbc927ca1c0322c4bc5fff9386ebed77608800a233bb84e2aa90147304402207da093cc43b904b62ca61abc15a166a4fb4a8fd0b6a3e15c12374519bfacdf7c02207132cd65e37e866674b73573b670099906af36e2ac1f42f4d9b3192a0045e7f701004d1e012067857f990354c9bbdda891429886eef7db55db21b8a664ba0d1be9b04d0fe9de7564532102fd9b5a58d8e1ac73afee2828b3b2b20338436622971862f2a284c62ad754b8642103462ab7041341dadd996dc12ef0c118ca8ccb546498cbf304f7ffe0f1b12f9a9e210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db54ae6702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b2453ae68ffffffff61733fc13d12e74a99ba4f79ea3cbcb6dc1714d21474b0611b2fe5adbfb592ef01000000fddb0100483045022100ac36e58fe7c0e14440fe18c8a2ffccd63670107f0f3594d03cd8707ac81107070220243d491f9eee6d4d00ace83d7d6e20c90f4ee958256f744f335ecd473f797cef01483045022100d0d2cfbc844fc9b5c2227f2212730c91bbe408ea29acad129f22fc508c49774102201fd93649a04e21bbd7de262bf8b45c51de92ad50233af6c8fa8ef3e066a80cdf01483045022100cdc5d7604c7141c0550c84ffd23ffc05835b993de83e425f82412e8aba7d178e02206c00861d371fc96438a2f5152b57b1ae04f31935bb6d8f8a1a01e92a985ed55001004cfc64532102fd9b5a58d8e1ac73afee2828b3b2b20338436622971862f2a284c62ad754b8642103462ab7041341dadd996dc12ef0c118ca8ccb546498cbf304f7ffe0f1b12f9a9e210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db54ae6702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b2453ae68ffffffff019ffd6c060000000017a9140e39a099dabb03863ae5484943896a7c9eb9f9dd8700000000"),
            // MIGRATION legacy fed - https://live.blockcypher.com/btc-testnet/tx/05d0ce41b35efe2953b90ba0386e51a766a36ec57db884717b90c8f457de2ca2/
            Arguments.of("01000000054e294946ccc7376ae76ec2263beb2037221a2cbc95e943f953dc92bc98231b0d01000000fdfe0000483045022100f38401ba5ff4b7fe1990f26f9e98f55936cedbe2333187586b03b13d6ca6bda8022046a5471e3d360a0c8a2eb6723fc595239dce8e8e82e9961f1939a129e0b908450148304502210096e74182c25bd45c0ed0d87d757f0f5da4af0b205459287fac30375867e597ab022064d605208b99711904eaf427d1f7355402db9ab65d1270d36223f0649f097225014c69522102cd53fc53a07f211641a677d250f6de99caf620e8e77071e811a28b3bcddf0be1210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db53aeffffffffd6c40bb4cb5a3cfd4b48e2ad243caa35d472f7a091bee367a60150360de3768102000000fdfd00004730440220798f44b16a540f8a1bc9e0339c20116f75c855c78ed83553ef60c1453128be60022060c22657b0eda37795232f43697d28ff8a32ae85ebe3cdc71efe509fe97607de01483045022100a7a9293cac5e3a2d37dc33b7a56440399c50f0f819a24e3c3862bab7c5132c3f0220138ed024da70824f16d465160e604ef82319ee69f29b1dea068254fe32f83348014c69522102cd53fc53a07f211641a677d250f6de99caf620e8e77071e811a28b3bcddf0be1210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db53aeffffffff25334cbc1c5fcf95fcad5dcc9f17a406139468c18b949016c9d3748d959e849f00000000fd1f010048304502210090947b0e033e640dc24b27f41adaafa7e6f59b90c02d92307807040997a1a7870220116e4510cb75879447f1ae34ec3972e6c31a802ce47b595a5c5978ce56bad41c0147304402207e383a1bc427ab220976e20c8216ea662a1cc3cab6203475a8120633ecab59ed022075dc624edbed76f155c05c40e771096f1f53c119097641efd3d6b38f3138deca014c8b20a1a48563166c5316fd15ec1e3b8d83f161d40e3fdae219d7e79bb05fb561ad5375522102cd53fc53a07f211641a677d250f6de99caf620e8e77071e811a28b3bcddf0be1210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db53aeffffffff8c13e4d58d985f5b0a8895ae1749e03152438a2503772c40b4ea54dc645d4cac00000000fd1f01004830450221009e4c09b36b151fe296d0464708056bbd3c1062a21a63ed111e9dfac96f84266e022000d379e9a61fb31ea065b39068cfac3bab99696f14ca2247f7f9c2f178509a3b014730440220756e0be3f7a091f0048e6558f200fe61ee484f312439bfeacafd1d8526a4008a0220792d883d72e856cb4a9289119dff36ad0b2adee0aac0df040615637f52ab21b4014c8b2054b37cdb7d99ffc5414d135411e2033bf9e4fe6e71952b7630c8c75fbda4b00775522102cd53fc53a07f211641a677d250f6de99caf620e8e77071e811a28b3bcddf0be1210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db53aeffffffff6fdd6fb90e4871e2bb288e7ed18d405b9158525586d4b1984ae134f9e62a5dc202000000fdfd000048304502210086b3afe9e406926490d6e15185b991c3371ae03b4002cb15fd25fa063ba4b53e022022e0a4bba63e4bc36795d431195af4d3a6c788cb5c3a2a925289ce4081f7abe401473044022079e8151ac277804e21b625fb1a527f2563914fee63c43c7bcacb4499945c04b802204d258730d7b3228bb602f9d35cfb6f8a6e2e9ce183643ee15b21424a12b25a87014c69522102cd53fc53a07f211641a677d250f6de99caf620e8e77071e811a28b3bcddf0be1210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db53aeffffffff01e4500c000000000017a91485c30fef900e9e491bb9fc8320ad73b7f69ff4dc8700000000"),
            // MIGRATION ErpFed(HOP) https://live.blockcypher.com/btc-testnet/tx/0018532387e8e364f0ac0d29daf1bc88874274e450e2eaaf361e11ab0101348c/
            Arguments.of("010000000542d166b51135bc06151fa59d99dea8f3105f8e18b658172949ff13c44f24cd4802000000fd6d0100473044022062306f48c423305cd978f5b8156380b78c3a0567597d4e898c5094a6506451d80220424cf1202e46839547d631ac517cc967a4fa0661b7f14024dae7b6af0681e69c01473044022074bd6548a5b69560966f83af5b1d47f68ff34cff4b84d57e7f640face766098802202f19783704e0e35d88ae196b21ad703e1d0fe928cb9d764cc46013a9ba4b8df001004cd9645221035834d4b1e6701d3612d51b81d666d1088ff48032d79a3def02ab2d46c8f4d3fe210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db536702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b245368aeffffffff7984e20d068b0bb2c7cbbf297de43450efcbb6342fd3b0d4b09f74612c799ca001000000fd6f0100483045022100ea637a2ff1b9e0aad2f4129d2d04de2f2c885970f748a58aebd4178bfbbfb3a80220347cdb8b29e6d02c344b07a32769ccad5340b2d83f88663ef314954619530205014830450221009a6bf8c6d30a374914b0cc8463a7c40b80aab6a12fd1479289eed06882ede98c02202653d43011f3f5a608447882d3d5492a7deebc1b38ad71db50ec00ee1b9b210b01004cd9645221035834d4b1e6701d3612d51b81d666d1088ff48032d79a3def02ab2d46c8f4d3fe210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db536702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b245368aeffffffff3f004d80c710d608bd107505e7600815fe383b9fe4af7127f3712f2c515ae6ae01000000fd6f0100483045022100de281f335299c6cc36c877ad0bfc0f0fd8e6eb6a4097e1675fa41e52db067efe022055f61d5ee2fae62aea7dc39cd6677981365a328a7f3a5daa3b38903010e47e9b014830450221009af1cdc3c8f64f2666b732f4a258a2cc491ac021fc05a94bf1a4a706355692e802200a5fb9a247751c8cb18908e28450739f57b64d4b1ed0b712ed710b8fb32b40dc01004cd9645221035834d4b1e6701d3612d51b81d666d1088ff48032d79a3def02ab2d46c8f4d3fe210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db536702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b245368aeffffffff69f343bdf1d7da6f11b82d9c6300e87f40576bff887ba69070262ad74b887fd701000000fd6f0100483045022100f4771ffabb41a48008e094a93bc7ef2ce27f5eaae7f10a38ab8d1190c456155202202064e99e3d8b7b3e1582ada429b20eefe090512af4539b455a1d408cdec8bb7401483045022100e983eaa181e2cb53758452da4fe11fec0884123d85fd6609c6fcc5719458aefc02200374f165a6c6f7bd2456ec1058719d03558baa037b13d5eb7d013dadae3278eb01004cd9645221035834d4b1e6701d3612d51b81d666d1088ff48032d79a3def02ab2d46c8f4d3fe210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db536702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b245368aeffffffffa9f4075b88e3ba8bd61e13fb0f0e7e96cb8d2c580d99515c82247c400e57e1ef01000000fd6f0100483045022100ef53ca3c03e896b67f17f04536d00ee2394c0348e0917ee849b068d0ed226a2202202acf9d4c19664c44b057cb113967e3ef3411da2b0878fb492c7e64acc6f1ce1c01483045022100baecbd3084fb20a91d9f1feb2106a031befb9ff6fcce904b9aa1a3b10a2db70d02206bc4d82a503025be3595256d8cd900232e4246a3c5eef88a3f7ddcf364af509f01004cd9645221035834d4b1e6701d3612d51b81d666d1088ff48032d79a3def02ab2d46c8f4d3fe210362634ab57dae9cb373a5d536e66a8c4f67468bbcfb063809bab643072d78a1242103c5946b3fbae03a654237da863c9ed534e0878657175b132b8ca630f245df04db536702d002b2755221029cecea902067992d52c38b28bf0bb2345bda9b21eca76b16a17c477a64e433012103284178e5fbcc63c54c3b38e3ef88adf2da6c526313650041b0ef955763634ebd2103b9fc46657cf72a1afa007ecf431de1cd27ff5cc8829fa625b66ca47b967e6b245368aeffffffff01e790ab000000000017a9148953b27da8f6969fb74fc738a46ff12bef067ff08700000000")
        );
    }

    @ParameterizedTest
    @MethodSource("pegoutOrMigrationArgProvider")
    void test_getFirstInputSigHash_pegout_or_migration(String btcTxHex) {
        // Arrange
        BtcTransaction btcTx = new BtcTransaction(btcMainnetParams, Hex.decode(btcTxHex));
        TransactionInput txInput = btcTx.getInput(FIRST_INPUT_INDEX);

        Optional<Script> redeemScriptFromInput = BridgeUtils.extractRedeemScriptFromInput(txInput);
        Assertions.assertTrue(redeemScriptFromInput.isPresent());
        RedeemScriptParser redeemScriptParser = RedeemScriptParserFactory.get(redeemScriptFromInput.get().getChunks());
        List<BtcECKey> pubKeys = redeemScriptParser.getPubKeys();
        Assertions.assertFalse(pubKeys.isEmpty());

        List<BtcECKey.ECDSASignature> signatures = BitcoinTestUtils.extractSignaturesFromTxInput(txInput);
        Assertions.assertEquals(signatures.size(), pubKeys.size() / 2 + 1);

        // Act
        Optional<Sha256Hash> firstInputSigHash = BitcoinUtils.getFirstInputSigHash(btcTx);
        Assertions.assertTrue(firstInputSigHash.isPresent());

        // Assert
        // It will be false if the extracted inputSigHash is different from the inputSigHash used for generating the signature.
        Assertions.assertTrue(isSigHashValid(firstInputSigHash.get(), pubKeys, signatures));
    }

    private static Stream<Arguments> peginArgProvider() {
        return Stream.of(
            // PEGIN BECH32 - https://www.blockchain.com/explorer/transactions/btc/aeb98f9a7632efefcd8f9d89b881a0d7a80e4e5c501482f8c9a57db1d7e919c0
            Arguments.of("010000000001012ee5f3cf0cf707d9fb1233653c3c8dfc96850cdf80ba716d4b4917d1ded876220000000000ffffffff0320a107000000000017a914056d0d9c5b14dd720d9f61fdb3f557c074f95cef8700000000000000001b6a1952534b5401a0df67b9589bd0527af41f66294a846da513e1f9f3c201000000000016001402bd283849dbe761ee7a8e9d902a5dee1f9807f20248304502210080e065d2ed38d819d26869e3ea25918adaa62fbaf1ce3a98e809a5c6a3c0beb10220669234d087835efcbccf21dbf225fee2abea4e37d29abead8a6da660812c450b01210210a19836ab556cc76f66ad8536fb613869db9676d123a7e56a1488369b646ed100000000"),
            // PEGIN legacy - https://www.blockchain.com/explorer/transactions/btc/529682fd067ba26a8406c809c605cde166d6818d0495f3c32bc74d100422fc30
            Arguments.of("02000000022ccf58addb0abd17bb89b8371d0359cfe56ea023b0cf0571e0ccd3917889c522000000006a47304402202cc1339e9090b57fa290a2c8506e82b360e07da2deeec0a56789f2623145668b02201b2d5d5c4d67f8ba217de8fc3269f70881b5669b5262daa29130271db7e0f7bd012103dd1adad32f93448dd9c86ea772c24152e9f85be8e116c336079d87f342b97badfdffffffdd9e3403bab1d06816b3547011cffafed2630606a3811b36ce2b61b80e34eab4000000006b483045022100b4986ebe1336d6468ddeec9461374b955e38d55e76f0e4c4f3d78df1c75e4298022052ed4e50f940680c81bc7299b69c81c7122f4250582035669f838328165548c9012103dd1adad32f93448dd9c86ea772c24152e9f85be8e116c336079d87f342b97badfdffffff0225a107000000000017a9142c1bab6ea51fdaf85c8366bd2b1502eaa69b6ae6871f221800000000001976a9140eda35d81e2a8537beebbbcdf63e3483be01269288acb1cd0b00"),
            // FLYOVER PEGIN - https://live.blockcypher.com/btc-testnet/tx/d3356587d46ccc887c577eff8d78bff4e81735fd5fcd6511499edc04d7f0c4e9/
            Arguments.of("020000000161733fc13d12e74a99ba4f79ea3cbcb6dc1714d21474b0611b2fe5adbfb592ef020000006a473044022016f565d5a69195deb489101ff20af2bca28a38f15915e9ad773b1b9bd9c6013c022041e61ce5d89182478a8ad1602308a7a1cea0b730552ca8ba2a9d3368f9bd8f9201210205cd73583ce9a42bda0bff53f52398e04c703dd8aa5de03dcf780e26e2ba4ca1fdffffff02237a08000000000017a914012c4ac8c51ba78e04a8531d3c5788e7a6af51e4872f98ab01000000001976a91435309691021c3e612408bcbc63220222e3cf746388acf4282500")
        );
    }

    @ParameterizedTest
    @MethodSource("peginArgProvider")
    void test_getFirstInputSigHash_pegin(String btcTxHex) {
        // Arrange
        BtcTransaction btcTx = new BtcTransaction(btcMainnetParams, Hex.decode(btcTxHex));

        // Act
        Optional<Sha256Hash> firstInputSigHash = BitcoinUtils.getFirstInputSigHash(btcTx);

        // Assert
        Assertions.assertFalse(firstInputSigHash.isPresent());
    }

    @Test
    void test_getFirstInputSigHash_no_input() {
        // Arrange
        BtcTransaction btcTx = new BtcTransaction(btcMainnetParams);
        btcTx.addOutput(Coin.COIN, destinationAddress);

        // Act
        Optional<Sha256Hash> sigHash = BitcoinUtils.getFirstInputSigHash(btcTx);

        // Assert
        Assertions.assertFalse(sigHash.isPresent());
    }

    @Test
    void test_getFirstInputSigHash_invalid_input_no_redeem_script() {
        // Arrange
        Address destinationAddress = BitcoinTestUtils.createP2PKHAddress(btcMainnetParams, "destinationAddress");

        BtcTransaction btcTx = new BtcTransaction(btcMainnetParams);
        btcTx.addInput(BitcoinTestUtils.createHash(1), 0, new Script(new byte[]{}));
        btcTx.addOutput(Coin.COIN, destinationAddress);

        // Act
        Optional<Sha256Hash> sigHash = BitcoinUtils.getFirstInputSigHash(btcTx);

        // Assert
        Assertions.assertFalse(sigHash.isPresent());
    }
}
