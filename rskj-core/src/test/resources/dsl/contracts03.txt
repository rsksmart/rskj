account_new acc1 10000000

transaction_build tx01
    sender acc1
    receiverAddress 00
    value 0
    data 606060405234610000576040516104b13803806104b1833981016040528051015b5b60008054600160a060020a03191633600160a060020a03161790555b8060019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061008957805160ff19168380011785556100b6565b828001600101855582156100b6579182015b828111156100b657825182559160200191906001019061009b565b5b506100d79291505b808211156100d357600081556001016100bf565b5090565b50505b505b6103c6806100eb6000396000f300606060405263ffffffff60e060020a600035041663368b8772811461005057806341c0e1b5146100a05780639530dcee146100af578063bfdfa9d7146100b9578063cfae3217146100c3575b610000565b61009e600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375094965061015095505050505050565b005b346100005761009e6101f0565b005b61009e610218565b005b61009e61004b565b005b34610000576100d061028b565b604080516020808252835181830152835191928392908301918501908083838215610116575b80518252602083111561011657601f1990920191602091820191016100f6565b505050905090810190601f1680156101425780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b8060019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061019c57805160ff19168380011785556101c9565b828001600101855582156101c9579182015b828111156101c95782518255916020019190600101906101ae565b5b506101ea9291505b808211156101e657600081556001016101d2565b5090565b50505b50565b60005433600160a060020a039081169116141561021557600054600160a060020a0316ff5b5b565b600060405160728061032983396040519101819003906000f0801561000057905080600160a060020a0316639530dcee6040518163ffffffff1660e060020a028152600401809050600060405180830381600087803b156100005760325a03f115610000575050505b50565b610000565b565b604080516020808201835260008252600180548451600282841615610100026000190190921691909104601f81018490048402820184019095528481529293909183018282801561031d5780601f106102f25761010080835404028352916020019161031d565b820191906000526020600020905b81548152906001019060200180831161030057829003601f168201915b505050505090505b9056006060604052346000575b605c8060166000396000f300606060405263ffffffff60e060020a6000350416639530dcee81146022575b6000565b6028601e565b005b6000565b5600a165627a7a7230582079a8db6ab9acab0210421a9f6854c22cb34fa7a7474e42081a824abb251114d50029a165627a7a72305820d5639cbd9ea61b4b64c8806e955b088630b252f81d2a8956f2385cc96ed1527c00290000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f48656c6c6f2c20436f6e74726163740000000000000000000000000000000000
    gas 1200000
    build

block_build b01
    parent g00
    transactions tx01
    build

block_connect b01

# Assert best block
assert_best b01

transaction_build tx02
    sender acc1
    nonce 1
    contract tx01   # created in tx01
    value 5000
    data 368b87720000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000e48656c6c6f2c2047726565746572000000000000000000000000000000000000
    gas 1000000
    build

block_build b02
    parent b01
    transactions tx02
    build

block_connect b02

# Assert best block
assert_best b02

# check account/contract balance (created in tx01)
assert_balance tx01 5000

transaction_build tx03
    sender acc1
    nonce 2
    contract tx01   # created in tx01
    value 5000
    data 368b87720000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001048656c6c6f2c2047726565746572203200000000000000000000000000000000
    gas 1000000
    build

block_build b03
    parent b02
    transactions tx03
    build

block_connect b03

# Assert best block
assert_best b03

# check account/contract balance (created in tx01)
assert_balance tx01 10000

transaction_build tx04
    sender acc1
    nonce 3
    contract tx01   # created in tx01
    value 5000
    data bfdfa9d7
    gas 1000000
    build

block_build b04
    parent b03
    transactions tx04
    build

block_connect b04

# Assert best block
assert_best b04

# check account/contract balance (created in tx01)
# it does not change, the last transaction raises an exception (throw in Solidity)
assert_balance tx01 10000

# check sender balance, before next transaction
assert_balance acc1 8589429

transaction_build tx05
    sender acc1
    nonce 4
    contract tx01   # created in tx01
    value 5000
    data 368b87720000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001048656c6c6f2c2047726565746572203300000000000000000000000000000000
    gas 25000
    build

block_build b05
    parent b04
    transactions tx05
    build

block_connect b05

# Assert best block
assert_best b05

# check account/contract balance (created in tx01)
# it does not change, the last transaction raises an exception (out of gas)
assert_balance tx01 10000

# check sender balance, it should pay the total cost (8589589 - 25000)
assert_balance acc1 8564429

transaction_build tx06
    sender acc1
    nonce 5
    contract tx01   # created in tx01
    value 5000
    data 9530dcee
    gas 1000000
    build

block_build b06
    parent b05
    transactions tx06
    build

block_connect b06

# Assert best block
assert_best b06

# check account/contract balance (created in tx01)
# it does not change, the last transaction raises an exception (in inner contract)
assert_balance tx01 10000

