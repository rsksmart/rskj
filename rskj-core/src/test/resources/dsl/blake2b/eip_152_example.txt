
comment

// Extracted from EIP-152 https://github.com/ethereum/EIPs/blob/master/EIPS/eip-152.md
contract Blake2b {
  event ResultOk();
  event Debug(bytes32);

  function F(uint32 rounds, bytes32[2] memory h, bytes32[4] memory m, bytes8[2] memory t, bool f) internal view returns (bytes32[2] memory) {
    bytes32[2] memory output;

    bytes memory args = abi.encodePacked(rounds, h[0], h[1], m[0], m[1], m[2], m[3], t[0], t[1], f);

    assembly {
      if iszero(staticcall(not(0), 0x09, add(args, 32), 0xd5, output, 0x40)) {
        revert(0, 0)
      }
    }

    return output;
  }

  function callF() public view returns (bytes32[2] memory) {
    uint32 rounds = 12;

    bytes32[2] memory h;
    h[0] = hex"48c9bdf267e6096a3ba7ca8485ae67bb2bf894fe72f36e3cf1361d5f3af54fa5";
    h[1] = hex"d182e6ad7f520e511f6c3e2b8c68059b6bbd41fbabd9831f79217e1319cde05b";

    bytes32[4] memory m;
    m[0] = hex"6162630000000000000000000000000000000000000000000000000000000000";
    m[1] = hex"0000000000000000000000000000000000000000000000000000000000000000";
    m[2] = hex"0000000000000000000000000000000000000000000000000000000000000000";
    m[3] = hex"0000000000000000000000000000000000000000000000000000000000000000";

    bytes8[2] memory t;
    t[0] = hex"03000000";
    t[1] = hex"00000000";

    bool f = true;

    return F(rounds, h, m, t, f);
  }

  function runTest() public {
    bytes32 expectedOutput1 = hex"ba80a53f981c4d0d6a2797b69f12f6e94c212f14685ac4b74b12bb6fdbffa2d1";
    bytes32 expectedOutput2 = hex"7d87c5392aab792dc252d5de4533cc9518d38aa8dbf1925ab92386edd4009923";

    bytes32[2] memory callFOutput = callF();

    bool matchExpected1 = callFOutput[0] == expectedOutput1;
    bool matchExpected2 = callFOutput[1] == expectedOutput2;

    require(matchExpected1, "blake2b.f: first value doesn't match expected value");
    require(matchExpected2, "blake2b.f: second value doesn't match expected value");

    emit ResultOk();
  }
}

end

account_new acc1 10000000000

# Deploy Contract

transaction_build tx01
    sender acc1
    receiverAddress 00
    value 0
    data 608060405234801561001057600080fd5b50610693806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c806382fe1c9b1461003b578063fc75ac4714610045575b600080fd5b61004361008b565b005b61004d6101f6565b6040518082600260200280838360005b8381101561007857808201518184015260208101905061005d565b5050505090500191505060405180910390f35b60007fba80a53f981c4d0d6a2797b69f12f6e94c212f14685ac4b74b12bb6fdbffa2d1905060007f7d87c5392aab792dc252d5de4533cc9518d38aa8dbf1925ab92386edd400992390506100dd610591565b6100e56101f6565b9050600083826000600281106100f757fe5b60200201511490506000838360016002811061010f57fe5b60200201511490508161016d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252603381526020018061062c6033913960400191505060405180910390fd5b806101c3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260348152602001806105f86034913960400191505060405180910390fd5b7f28ac248877e8517478dfc963b8e1f727f15b62bc721ea3aa078bd81873f8a88160405160405180910390a15050505050565b6101fe610591565b6000600c905061020c610591565b7f48c9bdf267e6096a3ba7ca8485ae67bb2bf894fe72f36e3cf1361d5f3af54fa58160006002811061023a57fe5b6020020181815250507fd182e6ad7f520e511f6c3e2b8c68059b6bbd41fbabd9831f79217e1319cde05b8160016002811061027157fe5b6020020181815250506102826105b3565b7f6162630000000000000000000000000000000000000000000000000000000000816000600481106102b057fe5b6020020181815250506000816001600481106102c857fe5b6020020181815250506000816002600481106102e057fe5b6020020181815250506000816003600481106102f857fe5b6020020181815250506103096105d5565b7f03000000000000000000000000000000000000000000000000000000000000008160006002811061033757fe5b602002019077ffffffffffffffffffffffffffffffffffffffffffffffff1916908177ffffffffffffffffffffffffffffffffffffffffffffffff19168152505060008160016002811061038757fe5b602002019077ffffffffffffffffffffffffffffffffffffffffffffffff1916908177ffffffffffffffffffffffffffffffffffffffffffffffff1916815250506000600190506103db85858585856103e5565b9550505050505090565b6103ed610591565b6103f5610591565b6060878760006002811061040557fe5b60200201518860016002811061041757fe5b60200201518860006004811061042957fe5b60200201518960016004811061043b57fe5b60200201518a60026004811061044d57fe5b60200201518b60036004811061045f57fe5b60200201518b60006002811061047157fe5b60200201518c60016002811061048357fe5b60200201518c604051602001808b63ffffffff1663ffffffff1660e01b81526004018a81526020018981526020018881526020018781526020018681526020018581526020018477ffffffffffffffffffffffffffffffffffffffffffffffff191677ffffffffffffffffffffffffffffffffffffffffffffffff191681526008018377ffffffffffffffffffffffffffffffffffffffffffffffff191677ffffffffffffffffffffffffffffffffffffffffffffffff19168152600801821515151560f81b81526001019a5050505050505050505050604051602081830303815290604052905060408260d5602084016009600019fa61058357600080fd5b819250505095945050505050565b6040518060400160405280600290602082028038833980820191505090505090565b6040518060800160405280600490602082028038833980820191505090505090565b604051806040016040528060029060208202803883398082019150509050509056fe626c616b6532622e663a207365636f6e642076616c756520646f65736e2774206d617463682065787065637465642076616c7565626c616b6532622e663a2066697273742076616c756520646f65736e2774206d617463682065787065637465642076616c7565a265627a7a72315820f6f4c217e94a3b7f87cedfc47c7b5b9a9ab1b048c36a62bcba4d0f9c20c6fc6264736f6c63430005100032
    gas 2000000
    build

# invoke runTest()

transaction_build tx02
    sender acc1
    nonce 1
    contract tx01   # created in tx01
    value 0
    #data 12ca565c
    data 82fe1c9b
    gas 2000000000
    build

block_build b01
    parent g00
    transactions tx01
    build

block_connect b01
assert_best b01
assert_tx_success tx01

block_build b02
    parent b01
    transactions tx02
    gasLimit 3000000000
    build

block_connect b02
assert_best b02
assert_tx_success tx02
