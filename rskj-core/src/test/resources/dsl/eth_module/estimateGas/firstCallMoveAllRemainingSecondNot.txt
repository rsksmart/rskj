comment

pragma solidity >=0.6.0 <0.9.0;

import "hardhat/console.sol";

contract CallWithValue {
    fallback () external payable { }

    function callWithValue() public payable {
        console.log("Test");
        payable(this).transfer(1);
    }
}

end

account_new acc1 20000000

# Deploy CallWithValue

transaction_build tx01
    sender acc1
    receiverAddress 00
    value 0
    data 608060405234801561001057600080fd5b50610261806100206000396000f3fe6080604052600436106100225760003560e01c8063c3cefd361461002557610023565b5b005b61002d61002f565b005b61006d6040518060400160405280600481526020017f54657374000000000000000000000000000000000000000000000000000000008152506100b7565b3073ffffffffffffffffffffffffffffffffffffffff166108fc60019081150290604051600060405180830381858888f193505050501580156100b4573d6000803e3d6000fd5b50565b61014d816040516024016100cb9190610209565b6040516020818303038152906040527f41304fac000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050610150565b50565b60008151905060006a636f6e736f6c652e6c6f679050602083016000808483855afa5050505050565b600081519050919050565b600082825260208201905092915050565b60005b838110156101b3578082015181840152602081019050610198565b60008484015250505050565b6000601f19601f8301169050919050565b60006101db82610179565b6101e58185610184565b93506101f5818560208601610195565b6101fe816101bf565b840191505092915050565b6000602082019050818103600083015261022381846101d0565b90509291505056fea2646970667358221220a8a66c304b9a9e4d431be47727398216384cb0b5f8a08cd93274a9a95c98a16c64736f6c63430008110033
    gas 2000000
    build

block_build b01
    parent g00
    transactions tx01
    build

block_connect b01
assert_best b01

transaction_build tx02
    sender acc1
    receiverAddress 6252703f5ba322ec64d3ac45e56241b7d9e481ad
    nonce 1
    value 100
    data c3cefd36
    gas 2000000
    build

block_build b02
    parent b01
    #transactions tx02
    build

block_connect b02
assert_best b02

block_build b03
    parent b02
    transactions tx02
    build

block_connect b03
assert_best b03

# Back to code test,
# you must estimate the gas needed
# to invoke callWithValue()
# and it should be greater than the gas used
# when executing the transaction
# Also, the gas used when executing the transaction
# should not be enough to invoke it again