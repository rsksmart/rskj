comment
compiled using solidity: "0.7.3"

pragma solidity >=0.6.0 <0.9.0;

contract NestedCallWithValue {
    address payable nextAddress;
    bool lastCall = false;

    event NestedCallWV();
    event LastCall();

    fallback () external payable { }

    function callAddressWithValue() public payable {
        if(!lastCall) {
            NestedCallWithValue(nextAddress).callAddressWithValue{value: msg.value, gas: gasleft() - 10000}();
            emit NestedCallWV();
        } else {
            emit LastCall();
        }
    }

    function setNextAddress(address payable n) public {
        nextAddress = n;
    }

    function setLastCall() public {
        lastCall = true;
    }
}
end

account_new acc1 20000000

# Deploy three instances of NestedCallWithValue

transaction_build tx01
    sender acc1
    nonce 0
    receiverAddress 00
    value 0
    data 608060405260008060146101000a81548160ff02191690831515021790555034801561002a57600080fd5b5061023f8061003a6000396000f3fe6080604052600436106100385760003560e01c80633aecee241461003b578063ba26473514610052578063fb60f709146100a357610039565b5b005b34801561004757600080fd5b506100506100ad565b005b34801561005e57600080fd5b506100a16004803603602081101561007557600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506100ca565b005b6100ab61010d565b005b6001600060146101000a81548160ff021916908315150217905550565b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600060149054906101000a900460ff166101da5760008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fb60f709346127105a03906040518363ffffffff1660e01b81526004016000604051808303818589803b15801561018f57600080fd5b5088f11580156101a3573d6000803e3d6000fd5b5050505050507fde0f1ac890b93f05f29eb21d0298f6bf3b9954213c196fefecdb445b4ed047a560405160405180910390a1610207565b7faf10f11658b97bcc0ed656fdfe4e20ca91e4a2a150f363233da11ec1d4898a4760405160405180910390a15b56fea2646970667358221220a49fa0e8a4947075a1ccbc823ca128cf2b35d6dc594337da9924f07596c2285b64736f6c63430007030033
    gas 2000000
    build

transaction_build tx02
    sender acc1
    nonce 1
    receiverAddress 00
    value 0
    data 608060405260008060146101000a81548160ff02191690831515021790555034801561002a57600080fd5b5061023f8061003a6000396000f3fe6080604052600436106100385760003560e01c80633aecee241461003b578063ba26473514610052578063fb60f709146100a357610039565b5b005b34801561004757600080fd5b506100506100ad565b005b34801561005e57600080fd5b506100a16004803603602081101561007557600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506100ca565b005b6100ab61010d565b005b6001600060146101000a81548160ff021916908315150217905550565b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600060149054906101000a900460ff166101da5760008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fb60f709346127105a03906040518363ffffffff1660e01b81526004016000604051808303818589803b15801561018f57600080fd5b5088f11580156101a3573d6000803e3d6000fd5b5050505050507fde0f1ac890b93f05f29eb21d0298f6bf3b9954213c196fefecdb445b4ed047a560405160405180910390a1610207565b7faf10f11658b97bcc0ed656fdfe4e20ca91e4a2a150f363233da11ec1d4898a4760405160405180910390a15b56fea2646970667358221220a49fa0e8a4947075a1ccbc823ca128cf2b35d6dc594337da9924f07596c2285b64736f6c63430007030033
    gas 2000000
    build

transaction_build tx03
    sender acc1
    nonce 2
    receiverAddress 00
    value 0
    data 608060405260008060146101000a81548160ff02191690831515021790555034801561002a57600080fd5b5061023f8061003a6000396000f3fe6080604052600436106100385760003560e01c80633aecee241461003b578063ba26473514610052578063fb60f709146100a357610039565b5b005b34801561004757600080fd5b506100506100ad565b005b34801561005e57600080fd5b506100a16004803603602081101561007557600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506100ca565b005b6100ab61010d565b005b6001600060146101000a81548160ff021916908315150217905550565b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600060149054906101000a900460ff166101da5760008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fb60f709346127105a03906040518363ffffffff1660e01b81526004016000604051808303818589803b15801561018f57600080fd5b5088f11580156101a3573d6000803e3d6000fd5b5050505050507fde0f1ac890b93f05f29eb21d0298f6bf3b9954213c196fefecdb445b4ed047a560405160405180910390a1610207565b7faf10f11658b97bcc0ed656fdfe4e20ca91e4a2a150f363233da11ec1d4898a4760405160405180910390a15b56fea2646970667358221220a49fa0e8a4947075a1ccbc823ca128cf2b35d6dc594337da9924f07596c2285b64736f6c63430007030033
    gas 2000000
    build

block_build b01
    parent g00
    transactions tx01 tx02 tx03
    build

block_connect b01
assert_best b01

# init next address 56aa252dd82173789984fa164ee26ce2da9336ff
transaction_build tx04
    sender acc1
    nonce 3
    receiverAddress 6252703f5ba322ec64d3ac45e56241b7d9e481ad
    data ba26473500000000000000000000000056aa252dd82173789984fa164ee26ce2da9336ff
    gas 2000000
    build

# init next address 27444fbce96cb2d27b94e116d1506d7739c05862
transaction_build tx05
    sender acc1
    nonce 4
    receiverAddress 56aa252dd82173789984fa164ee26ce2da9336ff
    data ba26473500000000000000000000000027444fbce96cb2d27b94e116d1506d7739c05862
    gas 2000000
    build

# init last call
transaction_build tx06
    sender acc1
    nonce 5
    receiverAddress 27444fbce96cb2d27b94e116d1506d7739c05862
    data 3aecee24
    gas 2000000
    build

block_build b02
    parent b01
    transactions tx04 tx05 tx06
    build

block_connect b02
assert_best b02

